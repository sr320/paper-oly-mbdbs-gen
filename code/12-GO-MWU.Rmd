---
title: "10-GO_MWU"
author: "Laura H Spencer"
date: "1/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Make input files for GO_MWU 

## Save loci IDS and GO TERMS for All LOCI that were identified in the GENE feature file, for use in GO_MWU (notebook 12)

```{r}
install.packages("ape")
require(ape)
```


```{r}
GO.MWU.GOterms <- allLoci.features.df %>% filter(feature == "gene") %>%
  mutate(Ontology_term = str_replace(Ontology_term, pattern="Ontology_term=",replacement = "")) %>%
  mutate(Ontology_term = str_replace(Ontology_term, pattern=";",replacement = "")) %>% 
  mutate(Ontology_term = str_replace_all(Ontology_term, pattern=",",replacement = ";")) %>%
  mutate(ID = paste(contig.allLoci, start.allLoci, sep="_")) %>%
  select(ID, Ontology_term) %>% drop_na(Ontology_term)

write.table(GO.MWU.GOterms, here::here("analyses", "GO_MWU", "GO_MWU_GO-terms"),sep="\t",quote = F,row.names = F, col.names=F)
```

## Save loci IDS and SIGNIFICANCE (0=significant, 1=not significant) for All LOCI that were identified in the GENE feature file, for use in GO_MWU (notebook 12)

```{r}
GO.MWU.DML.loci <- DML.features.df %>% filter(feature == "gene") %>%
  mutate(start=(start.dml+1)) %>%
  mutate(ID = paste(contig.dml, start, sep="_")) %>% 
  select(ID) 

GO.MWU.signif <- GO.MWU.GOterms %>%
  select(ID) %>%
  add_column(sig = c(1))

GO.MWU.signif[which(GO.MWU.signif$ID %in% GO.MWU.DML.loci$ID),]$sig <- 0


table(GO.MWU.GOterms$ID == GO.MWU.signif$ID)
  
write.table(GO.MWU.signif, here::here("analyses", "GO_MWU", "GO_MWU_signif"),sep="\t",quote = F,row.names = F, col.names=F)
```

## Save loci IDS and SIGNIFICANCE (q-values)  

ON HOLD - NOT SURE WHY THE NUMBER OF LOCI DIFFER SO MUCH HERE 

```{r}
# Create loi 
 getData(myDiff) %>% 
  mutate(ID = paste(chr, start, sep="_")) %>% 
  select(ID, qvalue) %>%
  filter(ID %in% GO.MWU.signif$ID) %>% nrow()

nrow(GO.MWU.signif)
```

## Run GO_MWU 

`input` = two columns of comma-separated values: gene id, continuous measure of significance. To perform standard GO enrichment analysis based on Fisher's exact test, use binary measure (0 or 1, i.e., either sgnificant or not). My file is located here: [/analyses/GO_MWU_signif](https://github.com/sr320/paper-oly-mbdbs-gen/blob/master/analyses/GO_MWU_signif?raw=true)

`goAnnotations` =  two-column, tab-delimited, one line per gene, multiple GO terms separated by semicolon. My file is located here: [/analyses/GO_MWU_GO-terms](https://github.com/sr320/paper-oly-mbdbs-gen/blob/master/analyses/GO_MWU_GO-terms?raw=true)

`goDatabase` = downloaded from http://current.geneontology.org/ontology/go.obo, and saved to the data subdirectory in this repo, [data/go.obo](https://github.com/sr320/paper-oly-mbdbs-gen/blob/master/data/go.obo?raw=true) 

`goDivision` = choose MF, or BP, or CC

---
